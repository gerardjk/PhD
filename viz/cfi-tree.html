<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ISO 10962 — CFI Tree</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    body { margin: 0; padding: 20px; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: #fff; }
    #container { display: flex; justify-content: center; align-items: center; }

    .link { fill: none; stroke-opacity: .45; stroke-width: 1.5; }
    .link--active { stroke-opacity: 1; stroke-width: 2; }
    .link-extension--active { stroke-opacity: .6; }

    text { font: 10px sans-serif; fill: #111; }
    .label--active { font-weight: 700; }
    .text-halo { paint-order: stroke; stroke: #fff; stroke-width: 3px; }
  </style>
</head>
<body>
  <div id="container"></div>

  <script>
    // Embedded CSV data (converted to JSON)
    const embeddedData = [{"Category (1st Char)":"E = Equities","Group (2nd Char)":"S = Common/Ordinary Shares","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"T = Restrictions; U = Free","Attribute 3 (5th Char)":"F = Fully Paid; O = Nil Paid; P = Partly Paid","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"P = Preferred/Preference Shares","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"R = Redeemable; E = Extendible; T = Redeemable/Extendible; G = Exchangeable; A = Redeemable/Exchangeable/Extendible; C = Redeemable/Exchangeable; N = Perpetual","Attribute 3 (5th Char)":"F = Fixed Rate; C = Cumulative Fixed Rate; P = Participating; Q = Cumulative Participating; A = Adjustable/Variable Rate; N = Normal Rate; U = Auction Rate; D = Dividends","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"C = Common/Ordinary Convertible Shares","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"T = Restrictions; U = Free","Attribute 3 (5th Char)":"F = Fully Paid; O = Nil Paid; P = Partly Paid","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"F = Preferred/Preference Convertible Shares","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"R = Redeemable; E = Extendible; T = Redeemable/Extendible; G = Exchangeable; A = Redeemable/Exchangeable/Extendible; C = Redeemable/Exchangeable; N = Perpetual","Attribute 3 (5th Char)":"F = Fixed Rate; C = Cumulative Fixed Rate; P = Participating; Q = Cumulative Participating; A = Adjustable/Variable Rate; N = Normal Rate; U = Auction Rate; D = Dividends","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"L = Limited Partnership Units","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"T = Restrictions; U = Free","Attribute 3 (5th Char)":"F = Fully Paid; O = Nil Paid; P = Partly Paid","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"D = Depositary Receipts","Attribute 1 (3rd Char)":"S = Common/Ordinary Shares; P = Preferred/Preference Shares; C = Common/Ordinary Convertible Shares; F = Preferred/Preference Convertible Shares; L = Limited Partnership Units; M = Others (Misc.)","Attribute 2 (4th Char)":"R = Redeemable; N = Perpetual; B = Convertible; D = Convertible/Redeemable; X = Not Appl./Undefined","Attribute 3 (5th Char)":"F = Fixed Rate; C = Cumulative Fixed Rate; P = Participating; Q = Cumulative Participating; A = Adjustable/Variable Rate; N = Normal Rate; U = Auction Rate; D = Dividends","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"Y = Structured Instruments (Participation)","Attribute 1 (3rd Char)":"A = Tracker Certificate; B = Outperforming Certificate; C = Bonus Certificate; D = Outperformance Bonus Certificate; E = Twin-Win-Certificate; M = Others (Misc.)","Attribute 2 (4th Char)":"D = Dividend Payments; Y = No Payments; M = Others (Misc.)","Attribute 3 (5th Char)":"F = Cash Repayment; V = Physical Repayment; E = Elect at Settlement; M = Others (Misc.)","Attribute 4 (6th Char)":"B = Baskets; S = Equities; D = Debt Instruments; G = Derivatives; T = Commodities; C = Currencies; I = Indices; N = Interest rates; M = Others (Misc.)"},{"Category (1st Char)":"E = Equities","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"V = Voting; N = Non-Voting; R = Restricted; E = Enhanced voting","Attribute 2 (4th Char)":"R = Redeemable; E = Extendible; T = Redeemable/Extendible; G = Exchangeable; A = Redeemable/Exchangeable/Extendible; C = Redeemable/Exchangeable; N = Perpetual","Attribute 3 (5th Char)":"F = Fixed Rate; C = Cumulative Fixed Rate; P = Participating; Q = Cumulative Participating; A = Adjustable/Variable Rate; N = Normal Rate; U = Auction Rate; D = Dividends","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"B = Bonds","Attribute 1 (3rd Char)":"F = Fixed Rate; Z = Zero Rate/Discounted; V = Variable; C = Cash Payment","Attribute 2 (4th Char)":"T = Government/State Guarantee; G = Joint Guarantee; S = Secured; U = Unsecured/Unguaranteed; P = Negative Pledge; N = Senior; O = Senior Subordinated; Q = Junior; J = Junior Subordinated; C = Supranational","Attribute 3 (5th Char)":"F = Fixed Maturity; G = Fixed Maturity with Call Feature; C = Fixed Maturity with Put Feature; D = Fixed Maturity with Put and Call; A = Amortization Plan; B = Amortization Plan with Call Feature; T = Amortization Plan with Put Feature; L = Amortization Plan with Put and Call; P = Perpetual; Q = Perpetual with Call Feature; R = Perpetual with Put Feature; E = Extendible","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"C = Convertible Bonds","Attribute 1 (3rd Char)":"F = Fixed Rate; Z = Zero Rate/Discounted; V = Variable; C = Cash Payment; K = Payment in Kind","Attribute 2 (4th Char)":"T = Government/State Guarantee; G = Joint Guarantee; S = Secured; U = Unsecured/Unguaranteed; P = Negative Pledge; N = Senior; O = Senior Subordinated; Q = Junior; J = Junior Subordinated; C = Supranational","Attribute 3 (5th Char)":"F = Fixed Maturity; G = Fixed Maturity with Call Feature; C = Fixed Maturity with Put Feature; D = Fixed Maturity with Put and Call; A = Amortization Plan; B = Amortization Plan with Call Feature; T = Amortization Plan with Put Feature; L = Amortization Plan with Put and Call; P = Perpetual; Q = Perpetual with Call Feature; R = Perpetual with Put Feature; E = Extendible","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"W = Bonds with Warrants Attached","Attribute 1 (3rd Char)":"F = Fixed Rate; Z = Zero Rate/Discounted; V = Variable","Attribute 2 (4th Char)":"T = Government/State Guarantee; G = Joint Guarantee; S = Secured; U = Unsecured/Unguaranteed; P = Negative Pledge; N = Senior; O = Senior Subordinated; Q = Junior; J = Junior Subordinated; C = Supranational","Attribute 3 (5th Char)":"F = Fixed Maturity; G = Fixed Maturity with Call Feature; C = Fixed Maturity with Put Feature; D = Fixed Maturity with Put and Call; A = Amortization Plan; B = Amortization Plan with Call Feature; T = Amortization Plan with Put Feature; L = Amortization Plan with Put and Call; P = Perpetual; Q = Perpetual with Call Feature; R = Perpetual with Put Feature; E = Extendible","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"T = Medium-Term Notes","Attribute 1 (3rd Char)":"F = Fixed Rate; Z = Zero Rate/Discounted; V = Variable","Attribute 2 (4th Char)":"T = Government/State Guarantee; G = Joint Guarantee; S = Secured; U = Unsecured/Unguaranteed; P = Negative Pledge; N = Senior; O = Senior Subordinated; Q = Junior; J = Junior Subordinated; C = Supranational","Attribute 3 (5th Char)":"F = Fixed Maturity; G = Fixed Maturity with Call Feature; C = Fixed Maturity with Put Feature; D = Fixed Maturity with Put and Call; A = Amortization Plan; B = Amortization Plan with Call Feature; T = Amortization Plan with Put Feature; L = Amortization Plan with Put and Call; P = Perpetual; Q = Perpetual with Call Feature; R = Perpetual with Put Feature; E = Extendible","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"Y = Money Market Instruments","Attribute 1 (3rd Char)":"F = Fixed Rate; Z = Zero Rate/Discounted; V = Variable; K = Payment in Kind","Attribute 2 (4th Char)":"T = Government/State Guarantee; G = Joint Guarantee; S = Secured; U = Unsecured/Unguaranteed; P = Negative Pledge; N = Senior; O = Senior Subordinated; Q = Junior; J = Junior Subordinated; C = Supranational","Attribute 3 (5th Char)":"F = Fixed Maturity; G = Fixed Maturity with Call Feature; C = Fixed Maturity with Put Feature; D = Fixed Maturity with Put and Call; A = Amortization Plan; B = Amortization Plan with Call Feature; T = Amortization Plan with Put Feature; L = Amortization Plan with Put and Call; P = Perpetual; Q = Perpetual with Call Feature; R = Perpetual with Put Feature; E = Extendible","Attribute 4 (6th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)"},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"G = Mortgage-Backed Securities","Attribute 1 (3rd Char)":"B = Bank Loan; P = Promissory Note; M = Others (Misc.)","Attribute 2 (4th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"N = Municipal Bonds","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"\"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"D = Debt Instruments","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"\"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"C = Collective Investment Vehicles","Group (2nd Char)":"S = Open-End Investment Fund (from Unit trusts Mutual funds OPCVM or OICVM)","Attribute 1 (3rd Char)":"O = Open-end; C = Closed-end","Attribute 2 (4th Char)":"I = Income funds; G = Growth funds; M = Mixed funds","Attribute 3 (5th Char)":"R = Real estate; S = Securities; M = Mixed-general; C = Commodities; D = Derivatives","Attribute 4 (6th Char)":"S = Shares; Q = Shares for QI; U = Units; Y = Units for QI"},{"Category (1st Char)":"C = Collective Investment Vehicles","Group (2nd Char)":"M = Closed-End Fund","Attribute 1 (3rd Char)":"O = Open-End; C = Closed-End; M = Others (Misc.)","Attribute 2 (4th Char)":"I = Income Funds; G = Accumulation Funds; J = Mixed Funds","Attribute 3 (5th Char)":"R = Real Estate; B = Debt Instruments; E = Equities; V = Convertible Securities; L = Mixed; C = Commodities; D = Derivatives; F = Referential Instruments; K = Credits; M = Others (Misc.)","Attribute 4 (6th Char)":"S = Shares; Q = Shares for QI; U = Units; Y = Units for QI"},{"Category (1st Char)":"C = Collective Investment Vehicles","Group (2nd Char)":"E = Exchange Traded Funds","Attribute 1 (3rd Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)","Attribute 2 (4th Char)":"B = Baskets; S = Equities; D = Debt Instruments/Interest Rates; T = Commodities; C = Currencies; I = Indices; M = Others (Misc.)","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"C = Collective Investment Vehicles","Group (2nd Char)":"Y = Structured (Capital Protection)","Attribute 1 (3rd Char)":"A = Capital Protection Certificate with Participation; B = Capital Protection Convertible Certificate; C = Barrier Capital Protection Certificate; D = Capital Protection Certificate with Coupons; M = Others (Misc.)","Attribute 2 (4th Char)":"F = Fixed Interest Payments; D = Dividend Payments; V = Variable Interest Payments; Y = No Payments; M = Others (Misc.)","Attribute 3 (5th Char)":"F = Fixed Cash Repayment (Only Protected Capital Level); V = Variable Cash Repayment; M = Others (Misc.)","Attribute 4 (6th Char)":"B = Baskets; S = Equities; D = Debt Instruments/Interest Rates; T = Commodities; C = Currencies; I = Indices; M = Others (Misc.)"},{"Category (1st Char)":"C = Collective Investment Vehicles","Group (2nd Char)":"D = Structured (without Capital Protection)","Attribute 1 (3rd Char)":"A = Discount Certificate; B = Barrier Discount Certificate; C = Reverse Convertible; D = Barrier Reverse Convertible; E = Express Certificate; M = Others (Misc.)","Attribute 2 (4th Char)":"R = Repayment in Cash; S = Repayment in Assets; C = Repayment in Assets and Cash; T = Repayment in Assets or Cash; M = Others (Misc.)","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"R = Entitlements (Rights)","Group (2nd Char)":"A = Allotment (Bonus) Rights","Attribute 1 (3rd Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"R = Entitlements (Rights)","Group (2nd Char)":"S = Subscription Rights","Attribute 1 (3rd Char)":"A = American; E = European; B = Bermudan; M = Others (Misc.)","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"B = Baskets; S = Stock-Equities; D = Debt Instruments; T = Commodities; C = Currencies; I = Indices; O = Options; F = Futures; W = Swaps; N = Interest Rates; M = Others (Misc.)","Attribute 4 (6th Char)":""},{"Category (1st Char)":"R = Entitlements (Rights)","Group (2nd Char)":"P = Purchase Rights","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"R = Entitlements (Rights)","Group (2nd Char)":"W = Warrants","Attribute 1 (3rd Char)":"T = Traditional Warrants; N = Naked Warrants; C = Covered Warrants","Attribute 2 (4th Char)":"C = Call; P = Put; B = Call and Put","Attribute 3 (5th Char)":"A = American; E = European; B = Bermudan; M = Others (Misc.)","Attribute 4 (6th Char)":"B = Baskets; S = Equities; D = Debt Instruments/Interest Rates; T = Commodities; C = Currencies; I = Indices; M = Others (Misc.)"},{"Category (1st Char)":"R = Entitlements (Rights)","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"T = Barrier Underlying Based; N = Barrier Instrument Based; M = Others (Misc.)","Attribute 2 (4th Char)":"C = Long; P = Short; M = Others (Misc.)","Attribute 3 (5th Char)":"A = American; E = European; B = Bermudan; M = Others (Misc.)","Attribute 4 (6th Char)":"B = Baskets; S = Equities; D = Debt Instruments/Interest Rates; T = Commodities; C = Currencies; I = Indices; M = Others (Misc.)"},{"Category (1st Char)":"O = Options","Group (2nd Char)":"C = Call Options","Attribute 1 (3rd Char)":"A = American; E = European; B = Bermudan; M = Others (Misc.)","Attribute 2 (4th Char)":"B = Baskets; S = Stock-Equities; D = Debt Instruments; T = Commodities; C = Currencies; I = Indices; O = Options; F = Futures; W = Swaps; N = Interest Rates; M = Others (Misc.)","Attribute 3 (5th Char)":"P = Physical; C = Cash; N = Non-Deliverable; E = Elect at Exercise","Attribute 4 (6th Char)":"S = Standardized; N = Non-Standardized"},{"Category (1st Char)":"O = Options","Group (2nd Char)":"P = Put Options","Attribute 1 (3rd Char)":"A = American; E = European; B = Bermudan; M = Others (Misc.)","Attribute 2 (4th Char)":"B = Baskets; S = Stock-Equities; D = Debt Instruments; T = Commodities; C = Currencies; I = Indices; O = Options; F = Futures; W = Swaps; N = Interest Rates; M = Others (Misc.)","Attribute 3 (5th Char)":"P = Physical; C = Cash; N = Non-Deliverable; E = Elect at Exercise","Attribute 4 (6th Char)":"S = Standardized; N = Non-Standardized"},{"Category (1st Char)":"O = Options","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"F = Futures","Group (2nd Char)":"F = Financial Futures","Attribute 1 (3rd Char)":"B = Baskets; S = Stock-Equities; D = Debt Instruments; C = Currencies; I = Indices; O = Options; F = Futures; W = Swaps; N = Interest Rates; V = Stock Dividend; M = Others (Misc.)","Attribute 2 (4th Char)":"P = Physical; C = Cash; N = Non-Deliverable","Attribute 3 (5th Char)":"S = Standardized; N = Non-Standardized","Attribute 4 (6th Char)":""},{"Category (1st Char)":"F = Futures","Group (2nd Char)":"C = Commodities Futures","Attribute 1 (3rd Char)":"E = Extraction Resources; A = Agriculture; I = Industrial Products; S = Services; N = Environmental; P = Polypropylene Products; H = Generated Resources; M = Others (Misc.)","Attribute 2 (4th Char)":"P = Physical; C = Cash; N = Non-Deliverable","Attribute 3 (5th Char)":"S = Standardized; N = Non-Standardized","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"S = Currency Swaps","Attribute 1 (3rd Char)":"P = Physical; A = Agriculture; J = Energy; K = Metals; N = Environmental; P = Polypropylene Products; S = Fertilizer; T = Paper; M = Others (Misc.)","Attribute 2 (4th Char)":"A = Agriculture; B = Baskets; J = Energy; K = Metals; N = Environmental; P = Polypropylene Products; S = Fertilizer; T = Paper; M = Others (Misc.)","Attribute 3 (5th Char)":"P = Physical; C = Cash; N = Non-Deliverable","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"I = Interest Rate Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"F = Fixed-Fixed Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"C = Fixed-Floating Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"B = Basis Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"T = Total Return Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"V = Variance/Volatility Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"E = Equity Swaps","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"S = Swaps","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"T = Spot","Group (2nd Char)":"T = Commodities","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"H = Non-Listed and Complex Listed Options","Group (2nd Char)":"","Attribute 1 (3rd Char)":"","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"J = Repos","Group (2nd Char)":"C = Cash Collateral Repo,G = General collateral; S = Specific security collateral\"","Attribute 1 (3rd Char)":"C = Cash collateral; F = Flexible; N = Overnight; O = Open; T = Term","Attribute 2 (4th Char)":"D = Delivery versus payment; H = Hold-in-custody; T = Tri-party","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":null},{"Category (1st Char)":"J = Repos","Group (2nd Char)":"S = Securities Collateral Repo","Attribute 1 (3rd Char)":"C = Cash collateral; G = Govt. bonds; P = Corporate bonds; T = Convertible bonds; E = Equity; L = Letter of credit; D = Cert. of deposit; W = Warrants; K = Money Market instruments; M = Others (Misc.)","Attribute 2 (4th Char)":"N = Overnight; O = Open; T = Term","Attribute 3 (5th Char)":"D = DvP / Delivery versus payment; F = Free of payment; H = Hold-in-custody; T = Tri-party","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"B = Bullion","Attribute 1 (3rd Char)":"N = National Currency; L = Legacy Currency; C = Bullion Coins; M = Others (Misc.)","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"C = Commodities","Attribute 1 (3rd Char)":"E = Extraction Resources; A = Agriculture; I = Industrial Products; S = Services; N = Environmental; P = Polypropylene Products; H = Generated Resources; M = Others (Misc.)","Attribute 2 (4th Char)":"N = Nominal; V = Variable; F = Fixed; R = Real; M = Others (Misc.)","Attribute 3 (5th Char)":"D = Daily; W = Weekly; N = Monthly; Q = Quarterly; S = Semi-Annually; A = Annually; M = Others (Misc.)","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"I = Indices","Attribute 1 (3rd Char)":"E = Equities; D = Debt; F = Collective Investment Vehicles; R = Real Estate; T = Commodities; C = Currencies; M = Others (Misc.)","Attribute 2 (4th Char)":"P = Price Weighted; C = Capitalization Weighted; E = Equal Weighted; F = Modified Market Capitalization Weighted; M = Others (Misc.)","Attribute 3 (5th Char)":"P = Price Return; N = Net Total Return; G = Gross Total Return; M = Others (Misc.)","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"R = Referential Instruments","Attribute 1 (3rd Char)":"E = Equities; D = Debt; F = Collective Investment Vehicles; I = Indices; T = Commodities; C = Currencies; M = Others (Misc.)","Attribute 2 (4th Char)":"S = Common Ordinary Shares; P = Preferred/Preference Shares; C = Common Ordinary Convertible Shares; F = Preferred/Preference Convertible Shares; L = Limited Partnership Units; K = Collective Investment Vehicles; M = Others (Misc.)","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"T = Combined Instruments","Attribute 1 (3rd Char)":"S = Combination of Shares; B = Combination of Bonds; H = Share and Bond; A = Share and Warrant; W = Warrant and Warrant; U = Fund Units and Other Components; M = Others (Misc.)","Attribute 2 (4th Char)":"T = Restrictions; U = Free","Attribute 3 (5th Char)":"B = Bearer; R = Registered; N = Bearer/Registered; M = Others (Misc.)","Attribute 4 (6th Char)":""},{"Category (1st Char)":"M = Miscellaneous","Group (2nd Char)":"M = Others (Misc.)","Attribute 1 (3rd Char)":"R = Real Estate Deeds; I = Insurance Policies; E = Escrow Receipts; T = Trade Finance Instruments; N = Carbon Credit; P = Precious Metal Receipts; S = Other OTC Derivative Products; M = Others (Misc.)","Attribute 2 (4th Char)":"","Attribute 3 (5th Char)":"","Attribute 4 (6th Char)":""}];

    function parseCSVToHierarchy(rows) {
      const root = { name: "ISO 10962 (CFI)", children: [] };

      // Build category -> groups structure
      const categoryMap = new Map();

      rows.forEach(row => {
        const catText = row['Category (1st Char)'];
        const grpText = row['Group (2nd Char)'];

        if (!catText) return;

        // Parse "E = Equities" format
        const catMatch = catText.match(/^([A-Z])\s*=\s*(.+)$/);
        if (!catMatch) return;

        const [, catCode, catName] = catMatch;

        // Get or create category
        if (!categoryMap.has(catCode)) {
          categoryMap.set(catCode, {
            type: "category",
            code: catCode,
            name: `${catCode} — ${catName.trim()}`,
            children: []
          });
        }

        // Parse and add group if present
        if (grpText && grpText.trim()) {
          const grpMatch = grpText.match(/^([A-Z])\s*=\s*(.+)$/);
          if (grpMatch) {
            const [, grpCode, grpName] = grpMatch;
            const category = categoryMap.get(catCode);

            // Check if group already exists
            const existingGroup = category.children.find(g => g.code === grpCode);
            if (!existingGroup) {
              category.children.push({
                type: "group",
                code: grpCode,
                name: `${grpCode} — ${grpName.trim()}`,
                children: []
              });
            }
          }
        }
      });

      // Convert map to array and add to root
      root.children = Array.from(categoryMap.values());

      return root;
    }

    (function init() {
      try {
        const hierarchyData = parseCSVToHierarchy(embeddedData);
        drawTree(hierarchyData);
      } catch (err) {
        console.error("Failed to load or draw tree:", err);
        alert("Error: " + err.message);
      }
    })();

    function drawTree(data) {
      // ---- Dimensions ----
      const width = 900;
      const height = 900;
      const outerRadius = Math.min(width, height) / 2;
      const innerRadius = outerRadius - 180;
      const labelPadding = 10;

      // ---- Colors ----
      const categories = data.children.map(d => d.code);
      const categoryNames = Object.fromEntries(data.children.map(d => [d.code, d.name]));

      // Use a distinct color palette for all 11 categories
      const colorPalette = [
        '#e41a1c',  // Red
        '#377eb8',  // Blue
        '#4daf4a',  // Green
        '#984ea3',  // Purple
        '#ff7f00',  // Orange
        '#a65628',  // Brown
        '#f781bf',  // Pink
        '#1b9e77',  // Teal
        '#d95f02',  // Dark Orange
        '#7570b3',  // Lavender
        '#e7298a'   // Magenta
      ];

      const categoryColors = d3.scaleOrdinal()
        .domain(categories)
        .range(colorPalette);

      // ---- SVG ----
      const svg = d3.select("#container").append("svg")
        .attr("width", width).attr("height", height)
        .attr("viewBox", [-width/2, -height/2, width, height])
        .attr("style", "max-width:100%;height:auto;");

      // ---- Layout ----
      const root = d3.hierarchy(data, d => d.children)
        .sort((a,b) => d3.ascending(a.data.name, b.data.name));

      const cluster = d3.cluster().size([360, innerRadius]).separation((a,b)=>1);
      cluster(root);

      // Set category for each node (find the top-level category ancestor)
      root.each(d => {
        // For nodes at depth 1, they ARE the category
        if (d.depth === 1) {
          d.category = d.data.code;
        } else if (d.depth > 1) {
          // For deeper nodes, find their category ancestor (depth 1)
          const ancestors = d.ancestors();
          const categoryNode = ancestors.find(x => x.depth === 1);
          d.category = categoryNode && categoryNode.data && categoryNode.data.code || null;
        } else {
          d.category = null;
        }
      });

      // ---- Path helpers ----
      function linkStep(startAngle, startRadius, endAngle, endRadius) {
        const a0 = (startAngle - 90) / 180 * Math.PI;
        const a1 = (endAngle   - 90) / 180 * Math.PI;
        const c0 = Math.cos(a0), s0 = Math.sin(a0);
        const c1 = Math.cos(a1), s1 = Math.sin(a1);
        return "M" + (startRadius * c0) + "," + (startRadius * s0)
             + (a1 === a0 ? "" : "A" + startRadius + "," + startRadius
             + " 0 0 " + (a1 > a0 ? 1 : 0) + " " + (startRadius * c1) + "," + (startRadius * s1))
             + "L" + (endRadius * c1) + "," + (endRadius * s1);
      }
      function linkConstant(d) { return linkStep(d.source.x, d.source.y, d.target.x, d.target.y); }
      function linkExtensionConstant(d) { return linkStep(d.target.x, d.target.y, d.target.x, innerRadius - labelPadding); }

      // ---- Color functions ----
      function linkStroke(d) {
        return categoryColors(d.target.category || categories[0]);
      }
      function labelFill(d) {
        return categoryColors(d.category || categories[0]);
      }

      // ---- Links ----
      const link = svg.append("g").attr("fill","none").selectAll("path")
        .data(root.links())
        .join("path")
          .attr("class", "link")
          .each(function(d){ d.target.linkNode = this; })
          .attr("d", linkConstant)
          .attr("stroke", linkStroke);

      // ---- Link extensions ----
      const linkExtension = svg.append("g")
        .attr("fill","none").attr("stroke","#000").attr("stroke-opacity",0.25)
        .selectAll("path")
        .data(root.links().filter(d => !d.target.children))
        .join("path")
          .each(function(d){ d.target.linkExtensionNode = this; })
          .attr("d", linkExtensionConstant);

      // ---- Labels (only leaves) ----
      const leaves = root.leaves();
      const labels = svg.append("g").selectAll("text")
        .data(leaves)
        .join("text")
          .attr("class","text-halo")
          .attr("dy",".31em")
          .attr("transform", d => `rotate(${d.x - 90}) translate(${innerRadius + labelPadding},0)${d.x < 180 ? "" : " rotate(180)"}`)
          .attr("text-anchor", d => d.x < 180 ? "start" : "end")
          .text(d => d.data.name)
          .attr("fill", labelFill)
          .style("font-size","10px")
          .on("mouseover", mouseovered(true))
          .on("mouseout", mouseovered(false));

      labels.append("title").text(d => d.data.name);

      function mouseovered(active) {
        return function(event, d) {
          d3.select(this).classed("label--active", active);
          if (d.linkExtensionNode) d3.select(d.linkExtensionNode).classed("link-extension--active", active).raise();
          do {
            if (d.linkNode) d3.select(d.linkNode).classed("link--active", active).raise();
            d = d.parent;
          } while (d);
        };
      }
    }
  </script>
</body>
</html>
